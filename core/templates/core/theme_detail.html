{% extends 'core/base.html' %}

{% block title %}{{ theme.title }}{% endblock %}

{% block content %}
<div style="max-width: 1200px; margin: 0 auto; padding: 2rem 1rem;">
    <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Ç–µ–º—ã -->
    <div style="background: linear-gradient(135deg, #2c3e50 0%, #4a6491 100%); color: white; border-radius: 10px; padding: 2rem; margin-bottom: 2rem; position: relative; overflow: hidden;">
        <div style="position: absolute; top: -50px; right: -50px; width: 200px; height: 200px; background: rgba(255,255,255,0.1); border-radius: 50%;"></div>
        <div style="position: absolute; bottom: -80px; left: -80px; width: 300px; height: 300px; background: rgba(255,255,255,0.05); border-radius: 50%;"></div>
        
        <div style="position: relative; z-index: 1;">
            <div style="display: flex; justify-content: space-between; align-items: start; flex-wrap: wrap; gap: 1rem;">
                <div style="flex-grow: 1;">
                    <h1 style="font-size: 2.5rem; margin-bottom: 1rem;">{{ theme.title }}</h1>
                    <p style="font-size: 1.1rem; opacity: 0.9; margin-bottom: 1.5rem; max-width: 800px;">
                        {{ theme.description }}
                    </p>
                    
                    <div style="display: flex; gap: 1.5rem; flex-wrap: wrap;">
                        <span style="background: rgba(255,255,255,0.2); padding: 0.5rem 1rem; border-radius: 20px;">
                            üìö {{ lessons.count }} —É—Ä–æ–∫–æ–≤
                        </span>
                        <span style="background: rgba(255,255,255,0.2); padding: 0.5rem 1rem; border-radius: 20px;">
                            üóìÔ∏è {{ theme.created_at|date:"d.m.Y" }}
                        </span>
                    </div>
                </div>
                
                {% if theme.image %}
                    <div style="flex-shrink: 0;">
                        <img src="{{ theme.image.url }}" 
                             alt="{{ theme.title }}" 
                             style="width: 200px; height: 200px; object-fit: cover; border-radius: 10px; border: 3px solid white;">
                    </div>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- –£—Ä–æ–∫–∏ —Ç–µ–º—ã -->
    <div style="background: rgba(255,255,255,0.95); border-radius: 10px; padding: 2rem; margin-bottom: 2rem;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem; flex-wrap: wrap; gap: 1rem;">
            <h2 style="color: #2d3748; font-size: 1.5rem; margin: 0;">
                –£—Ä–æ–∫–∏ –ø–æ —Ç–µ–º–µ "{{ theme.title }}"
            </h2>
            
            {% if user.is_staff %}
                <a href="{% url 'add_lesson' theme.id %}" 
                   style="display: inline-flex; align-items: center; padding: 0.5rem 1.25rem; background: #48bb78; color: white; text-decoration: none; border-radius: 5px; font-weight: 500; font-size: 0.9rem;">
                    <span style="margin-right: 0.5rem;">+</span>
                    –î–æ–±–∞–≤–∏—Ç—å —É—Ä–æ–∫
                </a>
            {% endif %}
        </div>

        {% if lessons %}
            <div style="display: flex; flex-direction: column; gap: 1rem;">
                {% for lesson in lessons %}
                    <div style="background: white; border-radius: 8px; padding: 1.5rem; border: 1px solid #e2e8f0; transition: all 0.3s; position: relative;">
                        <div style="display: flex; align-items: center; gap: 1rem;">
                            <div style="flex-shrink: 0;">
                                <div style="width: 50px; height: 50px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 1.25rem;">
                                    {{ forloop.counter }}
                                </div>
                            </div>
                            
                            <div style="flex-grow: 1;">
                                <div style="display: flex; justify-content: space-between; align-items: start; flex-wrap: wrap; gap: 1rem; margin-bottom: 0.5rem;">
                                    <h3 style="color: #2d3748; font-size: 1.25rem; margin: 0;">
                                        {{ lesson.title }}
                                    </h3>
                                    
                                    {% if user.is_authenticated %}
                                        {% with profile=user.userprofile %}
                                            {% if lesson in profile.completed_lessons.all %}
                                                <span style="background: #c6f6d5; color: #22543d; padding: 0.25rem 0.75rem; border-radius: 15px; font-size: 0.875rem; font-weight: 500;">
                                                    ‚úÖ –ü—Ä–æ–π–¥–µ–Ω
                                                </span>
                                            {% endif %}
                                        {% endwith %}
                                    {% endif %}
                                </div>
                                
                                <p style="color: #718096; margin-bottom: 1rem; line-height: 1.5;">
                                    {{ lesson.content|truncatechars:200 }}
                                </p>
                                
                                <div style="display: flex; gap: 1rem; align-items: center;">
                                    {% if lesson.video_url %}
                                        <span style="color: #667eea; font-size: 0.875rem;">
                                            üé• –í–∏–¥–µ–æ –≤–∫–ª—é—á–µ–Ω–æ
                                        </span>
                                    {% endif %}
                                    
                                    <span style="color: #a0aec0; font-size: 0.875rem;">
                                        {{ lesson.tasks.count }} –∑–∞–¥–∞–Ω–∏–π
                                    </span>
                                </div>
                            </div>
                            
                            <div style="flex-shrink: 0;">
                                <a href="{% url 'lesson_detail' lesson.id %}" 
                                   style="display: inline-flex; align-items: center; padding: 0.5rem 1.25rem; background: #667eea; color: white; text-decoration: none; border-radius: 5px; font-weight: 500; transition: background 0.3s;">
                                    –ò–∑—É—á–∏—Ç—å
                                    <span style="margin-left: 0.5rem;">‚Üí</span>
                                </a>
                            </div>
                        </div>
                        
                        <!-- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –¥–ª—è –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π -->
                        {% if user.is_authenticated %}
                            {% with profile=user.userprofile %}
                                {% if lesson in profile.completed_lessons.all %}
                                    <div style="position: absolute; top: 0; left: 0; right: 0; height: 3px; background: #48bb78; border-radius: 8px 8px 0 0;"></div>
                                {% endif %}
                            {% endwith %}
                        {% endif %}
                    </div>
                {% endfor %}
            </div>
        {% else %}
            <div style="text-align: center; padding: 3rem;">
                <div style="font-size: 4rem; margin-bottom: 1rem;">üìù</div>
                <h3 style="color: #2d3748; margin-bottom: 0.5rem;">–£—Ä–æ–∫–∏ –ø–æ–∫–∞ –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω—ã</h3>
                <p style="color: #718096;">–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä —Å–∫–æ—Ä–æ –¥–æ–±–∞–≤–∏—Ç —É—á–µ–±–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã –ø–æ —ç—Ç–æ–π —Ç–µ–º–µ</p>
                
                {% if user.is_staff %}
                    <div style="margin-top: 1.5rem;">
                        <a href="{% url 'add_lesson' theme.id %}" 
                           style="display: inline-flex; align-items: center; padding: 0.75rem 1.5rem; background: #48bb78; color: white; text-decoration: none; border-radius: 5px; font-weight: 500; font-size: 1rem;">
                            <span style="margin-right: 0.5rem;">+</span>
                            –î–æ–±–∞–≤–∏—Ç—å –ø–µ—Ä–≤—ã–π —É—Ä–æ–∫
                        </a>
                    </div>
                {% endif %}
            </div>
        {% endif %}
    </div>

    <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è -->
    <div style="display: flex; justify-content: space-between; flex-wrap: wrap; gap: 1rem; margin-top: 2rem;">
        <a href="{% url 'themes' %}" 
           style="display: inline-flex; align-items: center; padding: 0.75rem 1.5rem; background: #e2e8f0; color: #4a5568; text-decoration: none; border-radius: 5px; font-weight: 500;">
            ‚Üê –í—Å–µ —Ç–µ–º—ã
        </a>
        
        {% if user.is_authenticated and lessons %}
            <a href="{% url 'lesson_detail' lessons.first.id %}" 
               style="display: inline-flex; align-items: center; padding: 0.75rem 1.5rem; background: #667eea; color: white; text-decoration: none; border-radius: 5px; font-weight: 500;">
                –ù–∞—á–∞—Ç—å –∏–∑—É—á–µ–Ω–∏–µ
                <span style="margin-left: 0.5rem;">‚Üí</span>
            </a>
        {% endif %}
    </div>
</div>

<style>
    .lesson-card:hover {
        transform: translateX(5px);
        box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        border-color: #cbd5e0;
    }
    
    a:hover {
        opacity: 0.9;
    }
</style>

<script>
    // –î–æ–±–∞–≤–ª—è–µ–º hover-—ç—Ñ—Ñ–µ–∫—Ç –¥–ª—è –∫–∞—Ä—Ç–æ—á–µ–∫ —É—Ä–æ–∫–æ–≤
    document.addEventListener('DOMContentLoaded', function() {
        const lessonCards = document.querySelectorAll('.lesson-card');
        lessonCards.forEach(card => {
            card.addEventListener('mouseenter', function() {
                this.style.transform = 'translateX(5px)';
                this.style.boxShadow = '0 4px 12px rgba(0,0,0,0.1)';
                this.style.borderColor = '#cbd5e0';
            });
            
            card.addEventListener('mouseleave', function() {
                this.style.transform = 'translateX(0)';
                this.style.boxShadow = 'none';
                this.style.borderColor = '#e2e8f0';
            });
        });
    });
</script>
{% endblock %}